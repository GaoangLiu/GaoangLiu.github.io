---
layout: post
title: Conditional Random Field
date: 2021-07-15
tags: crf
categories: algorithm
author: gaonagliu
---
* content
{:toc}


## 随机场与马尔科夫随机场

**随机场是由若干个位置组成的整体，当给每一个位置中按照某种分布随机赋予一个值之后，其全体就叫做随机场**。以词性标注为例：假如有一个十个词形成的句子需要做词性标注。这十个词每个词的词性可以在已知的词性集合（名词，动词...)中去选择。当我们为每个词选择完词性后，这就形成了一个随机场。




**马尔科夫随机场是随机场的特例，它假设随机场中某一个位置的赋值仅仅与和它相邻的位置的赋值有关，和与其不相邻的位置的赋值无关**。继续考虑句子词性标注的例子：如果我们假设所有词的词性只和它相邻的词的词性有关时，这个随机场就特化成一个马尔科夫随机场。比如第三个词的词性除了与自己本身的位置有关外，只与第二个词和第四个词的词性有关。　

## 马尔科夫随机场与条件随机场

CRF 是马尔科夫随机场的特例，它假设马尔科夫随机场中只有 X 和 Y 两种变量，X 一般是给定的，而 Y 一般是在给定X的条件下的输出。这样马尔科夫随机场就特化成了条件随机场。在我们十个词的句子词性标注的例子中，X 是词，Y 是词性。因此，如果我们假设它是一个马尔科夫随机场，那么它也就是一个CRF。

对于 CRF，用数学语言描述：设 X 与 Y 是随机变量，P(Y|X) 是给定 X 时 Y 的条件概率分布，若随机变量 Y 构成的是一个马尔科夫随机场，则称条件概率分布 P(Y|X) 是条件随机场。

## 从条件随机场到线性链条件随机场

在CRF的定义中，我们并没有要求X和Y有相同的结构。而实现中，我们一般都假设X和Y有相同的结构。即 $$X=(X_1, ...,X_n)$$



# 条件随机场

concepts

1. 属于对数线性模型; 
2. 条件随机场是条件概率分布模型 P(Y|X) ，表示的是给定一组输入随机变量 X 的条件下另一组输出随机变量 Y 的马尔可夫随机场，也就是说 CRF 的特点是假设输出随机变量构成马尔可夫随机场。

设有联合概率分布 $$P(Y)$$，由无向图 $$G=(V,E)$$ 表示，在图 $$G$$ 中，结点表示随机变量，边表示随机变量之间的依赖关系，如果联合概率分布 $$P(Y)$$ 满足成对、局部或全局马尔可夫性，就称此联合概率分布为**马尔可夫随机场**（Markov random filed）也称**概率无向图模型**（probablistic undirected graphical model）：

- 成对马尔可夫性：设 $$u,v$$是无向图 $$G$$ 中任意两个没有边连接的结点，其他所有结点表示为 $$O$$ ，对应的随机变量分别用 $$Y_u, Y_v, Y_O$$表示，成对马尔可夫性是指给定随机变量组 $$Y_O$$ 的条件下随机变量 $$ Y_u, Y_v$$ 是条件独立的，如下：

    $$P(Y_u, Y_v|Y_O) = P(Y_u|Y_O) P(Y_v|Y_O)$$
    
- 局部马尔可夫性：设 $$v \in V$$ 是 $$G$$ 中任意一个节点，$$W$$ 是与 $$v$$ 有边连接的所有节点，$$O$$ 是 $$v, W$$ 外的其他所有节点。$$v, W, O$$ 表示的随机变量分别是 $$Y_v, Y_W, Y_O$$。局部马尔可夫性是在给定随机变量组 $$Y_W$$ 的条件下随机变量 $$Y_v$$ 与随机变量 $$Y_O$$ 是独立的:
    
    $$P(Y_v, Y_O|Y_W) = P(Y_v|Y_W) P(Y_O|Y_W)$$

- 全局马尔可夫性：$$A, B$$ 是 $$G$$ 中被 $$C$$ 分开的任意节点集合。全局马尔科夫性是指给定 $$Y_C$$ 条件下$$Y_A$$和$$Y_B$$是条件独立的，即

    $$P(Y_A,Y_B|Y_C) = P(Y_A|Y_C) P(Y_B|Y_C)$$

<img src="{{site.baseurl}}/images/2021/global_markov.png" >


## 实现
- 基于 PyTorch 的实现 [pytorch-crf](https://pytorch-crf.readthedocs.io/en/stable/#installation)



# 小结
## 条件随机场 v.s. HMM

隐马尔可夫模型中存在两个假设：**输出独立性假设和马尔可夫性假设**。其中，输出独立性假设要求序列数据严格相互独立才能保证推导的正确性，而事实上大多数序列数据不能被表示成一系列独立事件。而条件随机场则使用一种概率图模型，具有**表达长距离依赖性和交叠性特征的能力**，能够较好地解决标注（分类）偏置等问题的优点，而且所有特征可以进行全局归一化，能够求得全局的最优解。


read this series
1. crf https://www.cnblogs.com/en-heng/p/6214023.html
2. memm 最大熵马尔可夫模型 https://www.cnblogs.com/en-heng/p/6201893.html
3. hmm https://www.cnblogs.com/en-heng/p/6164145.html

# References

- [博客园-浅谈分词算法（4）基于字的分词方法（CRF）](https://www.cnblogs.com/xlturing/p/10161840.html)
- [知乎-条件随机场 CRF](https://zhuanlan.zhihu.com/p/29989121)